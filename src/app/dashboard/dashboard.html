<div class="dashboard-wrap">
  <!-- Sidebar (fijo e informativo) -->
  <aside class="sidebar" role="complementary" aria-label="Sidebar">
    <div class="sidebar-top">
      <div class="brand">
        <div class="logo">üìä</div>
        <div class="title">Dashboard Cr√©ditos</div>
      </div>

      <div class="sidebar-info" *ngIf="countries.length">
        <h4>üìã Informaci√≥n general</h4>
        <div class="info-list">
          <div class="info-item">
            <strong>Pa√≠ses:</strong>
            <span class="info-value">{{ countries.length }}</span>
          </div>
          <div class="info-item">
            <strong>A√±os:</strong>
            <span class="info-value">{{ availableYears.length }}</span>
          </div>
          <div class="info-item">
            <strong>Registros:</strong>
            <span class="info-value">{{ excelData.length }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-footer">
      <small>Desarrollado por <strong>Billy Salmer√≥n üêæ</strong></small>
    </div>
  </aside>

  <!-- Contenido principal -->
  <main class="main" role="main">
    <div class="content-wrapper">
      <header class="topbar">
        <div class="topbar-left">
          <h1>üìà An√°lisis de Cr√©ditos por Pa√≠s</h1>
          <p class="muted" *ngIf="!excelData.length">Carga un archivo Excel para comenzar</p>
          <p class="success" *ngIf="excelData.length && countries.length">
            ‚úÖ {{ excelData.length }} pa√≠ses ‚Ä¢ {{ availableYears.length }} a√±os
          </p>
        </div>
      </header>

      <!-- Upload -->
      <section class="upload-section card">
        <div class="section-header">
          <span class="icon">üìÅ</span>
          <h3>Cargar archivo Excel</h3>
        </div>
        <app-excel (dataLoaded)="onDataLoaded($event)"></app-excel>
      </section>

      <!-- Modo de visualizaci√≥n -->
      <section class="mode-section card" *ngIf="countries.length">
        <div class="section-header">
          <span class="icon">üîç</span>
          <h3>Modo de Visualizaci√≥n</h3>
        </div>
        <div class="mode-buttons">
          <button class="mode-btn" [class.active]="comparisonMode === 'single'"
            (click)="comparisonMode = 'single'; updateAll()">
            üìä Vista Individual
          </button>
          <button class="mode-btn" [class.active]="comparisonMode === 'compareCountries'"
            (click)="comparisonMode = 'compareCountries'; updateAll()">
            ‚öñÔ∏è Comparar Pa√≠ses
          </button>
          <button class="mode-btn" [class.active]="comparisonMode === 'compareYears'"
            (click)="comparisonMode = 'compareYears'; updateAll()">
            üìÖ Comparar A√±os
          </button>
        </div>
      </section>

      <!-- Vista Individual -->
      <section *ngIf="comparisonMode === 'single' && excelData.length && countries.length">
        <!-- Filtros -->
        <!-- En Vista Individual, solo mostrar filtro de pa√≠s -->
        <section class="filters card">
          <div class="section-header">
            <span class="icon">üéØ</span>
            <h3>Filtros</h3>
          </div>
          <div class="filter-row">
            <div class="filter-item">
              <label class="filter-label">Pa√≠s:</label>
              <select class="filter-select" [(ngModel)]="selectedCountry" (change)="changeCountry(selectedCountry)">
                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
              </select>
            </div>
          </div>
        </section>

        <!-- Estad√≠sticas -->
        <div class="stats card">
          <div class="section-header">
            <span class="icon">üìä</span>
            <h3>Estad√≠sticas - {{ selectedCountry || '‚Äî' }}</h3>
          </div>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">M√°ximo:</span>
              <strong class="stat-value">{{ stats.max }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">M√≠nimo:</span>
              <strong class="stat-value">{{ stats.min }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">Suma:</span>
              <strong class="stat-value">{{ stats.sum }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">Promedio:</span>
              <strong class="stat-value">{{ stats.mean }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">Moda:</span>
              <strong class="stat-value">{{ stats.mode }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">Varianza:</span>
              <strong class="stat-value">{{ stats.variance }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">Desviaci√≥n:</span>
              <strong class="stat-value">{{ stats.stdDev }}</strong>
            </div>
          </div>
        </div>

        <!-- Gr√°ficos -->
        <div class="charts-primary">
          <div class="chart-container card">
            <div class="chart-header">
              <span class="icon">üìà</span>
              <h4 class="chart-title">Gr√°fico de Dispersi√≥n - {{ selectedCountry }}</h4>
            </div>
            <div class="chart-inner">
              <apx-chart [series]="scatterChartOptions.series" [chart]="scatterChartOptions.chart"
                [xaxis]="scatterChartOptions.xaxis" [yaxis]="scatterChartOptions.yaxis"
                [dataLabels]="scatterChartOptions.dataLabels" [markers]="scatterChartOptions.markers"
                [title]="scatterChartOptions.title">
              </apx-chart>
            </div>
          </div>

          <div class="chart-container card">
            <div class="chart-header">
              <span class="icon">üìâ</span>
              <h4 class="chart-title">Histograma - {{ selectedCountry }}</h4>
            </div>
            <div class="chart-inner">
              <apx-chart [series]="histChartOptions.series" [chart]="histChartOptions.chart"
                [xaxis]="histChartOptions.xaxis" [yaxis]="histChartOptions.yaxis"
                [dataLabels]="histChartOptions.dataLabels" [fill]="histChartOptions.fill"
                [title]="histChartOptions.title">
              </apx-chart>
            </div>
          </div>
        </div>
      </section>

      <!-- Comparaci√≥n entre pa√≠ses -->
      <section class="comparison-section" *ngIf="comparisonMode === 'compareCountries' && countries.length">
        <div class="comparison-filters card">
          <div class="section-header">
            <span class="icon">‚öñÔ∏è</span>
            <h3>Comparaci√≥n entre Pa√≠ses</h3>
          </div>

          <div class="comparison-filters-row">
            <div class="comparison-item">
              <label class="filter-label">Pa√≠s 1:</label>
              <select class="filter-select" [(ngModel)]="selectedCountry1" (change)="compareCountries()">
                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
              </select>
            </div>

            <div class="comparison-item">
              <label class="filter-label">Pa√≠s 2:</label>
              <select class="filter-select" [(ngModel)]="selectedCountry2" (change)="compareCountries()">
                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Estad√≠sticas comparativas -->
        <div class="comparison-stats" *ngIf="comparisonStats.country1">
          <div class="stats-comparison">
            <div class="country-stats card">
              <h4>{{ comparisonStats.country1.name }}</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">M√°ximo:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.max }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">M√≠nimo:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.min }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Suma:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.sum }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Promedio:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.mean }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Moda:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.mode }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Varianza:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.variance }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Desviaci√≥n:</span>
                  <strong class="stat-value">{{ comparisonStats.country1.stdDev }}</strong>
                </div>
              </div>
            </div>

            <div class="country-stats card">
              <h4>{{ comparisonStats.country2.name }}</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">M√°ximo:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.max }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">M√≠nimo:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.min }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Suma:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.sum }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Promedio:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.mean }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Moda:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.mode }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Varianza:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.variance }}</strong>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Desviaci√≥n:</span>
                  <strong class="stat-value">{{ comparisonStats.country2.stdDev }}</strong>
                </div>
              </div>
            </div>
          </div>

          <!-- Gr√°fico comparativo -->
          <div class="chart-container card">
            <div class="chart-header">
              <span class="icon">üìà</span>
              <h4 class="chart-title">Comparaci√≥n de Tendencias - {{ selectedCountry1 }} vs {{ selectedCountry2 }}</h4>
            </div>
            <div class="chart-inner">
              <apx-chart [series]="comparisonChartOptions.series" [chart]="comparisonChartOptions.chart"
                [xaxis]="comparisonChartOptions.xaxis" [yaxis]="comparisonChartOptions.yaxis"
                [dataLabels]="comparisonChartOptions.dataLabels" [markers]="comparisonChartOptions.markers"
                [fill]="comparisonChartOptions.fill" [title]="comparisonChartOptions.title">
              </apx-chart>
            </div>
          </div>
        </div>

        <!-- Mensaje cuando no hay datos para comparar -->
        <div class="no-comparison card" *ngIf="!comparisonStats.country1">
          <div class="no-data-message">
            <span class="icon">‚ÑπÔ∏è</span>
            <h4>Selecciona dos pa√≠ses para comparar</h4>
            <p>Elige dos pa√≠ses diferentes de la lista para ver su comparaci√≥n</p>
          </div>
        </div>
      </section>

      <!-- Comparaci√≥n entre a√±os -->
      <section class="comparison-section" *ngIf="comparisonMode === 'compareYears' && countries.length">
        <div class="comparison-filters card">
          <div class="section-header">
            <span class="icon">üìÖ</span>
            <h3>Comparaci√≥n entre A√±os</h3>
          </div>

          <div class="comparison-filters-row-3">
            <div class="comparison-item">
              <label class="filter-label">Pa√≠s:</label>
              <select class="filter-select" [(ngModel)]="selectedCountry" (change)="compareYears()">
                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
              </select>
            </div>

            <div class="comparison-item">
              <label class="filter-label">A√±o 1:</label>
              <select class="filter-select" [(ngModel)]="selectedYear1" (change)="compareYears()">
                <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
              </select>
            </div>

            <div class="comparison-item">
              <label class="filter-label">A√±o 2:</label>
              <select class="filter-select" [(ngModel)]="selectedYear2" (change)="compareYears()">
                <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Estad√≠sticas comparativas por a√±o -->
        <div class="comparison-stats" *ngIf="yearComparisonStats.year1">
          <div class="stats-comparison">
            <div class="year-stats card">
              <h4>A√±o {{ selectedYear1 }}</h4>
              <div class="year-stat-item">
                <span class="stat-label">Cr√©ditos:</span>
                <strong class="stat-value">{{ yearComparisonStats.year1.credits | number }}</strong>
              </div>
              <div class="year-stat-item">
                <span class="stat-label">Diferencia:</span>
                <strong class="stat-value" [class.positive]="yearComparisonStats.difference > 0"
                  [class.negative]="yearComparisonStats.difference < 0">
                  {{ yearComparisonStats.difference > 0 ? '+' : '' }}{{ yearComparisonStats.difference | number }}
                  ({{ yearComparisonStats.percentageDifference > 0 ? '+' : '' }}{{
                  yearComparisonStats.percentageDifference }}%)
                </strong>
              </div>
            </div>

            <div class="year-stats card">
              <h4>A√±o {{ selectedYear2 }}</h4>
              <div class="year-stat-item">
                <span class="stat-label">Cr√©ditos:</span>
                <strong class="stat-value">{{ yearComparisonStats.year2.credits | number }}</strong>
              </div>
              <div class="year-stat-item">
                <span class="stat-label">Tendencia:</span>
                <strong class="stat-value" [class.positive]="yearComparisonStats.difference > 0"
                  [class.negative]="yearComparisonStats.difference < 0">
                  {{ yearComparisonStats.difference > 0 ? 'üìà Aumento' : 'üìâ Disminuci√≥n' }}
                </strong>
              </div>
            </div>
          </div>

          <!-- Gr√°fico comparativo de a√±os -->
          <div class="chart-container card">
            <div class="chart-header">
              <span class="icon">üìä</span>
              <h4 class="chart-title">Comparaci√≥n de A√±os - {{ selectedYear1 }} vs {{ selectedYear2 }}</h4>
            </div>
            <div class="chart-inner">
              <apx-chart [series]="yearComparisonChartOptions.series" [chart]="yearComparisonChartOptions.chart"
                [xaxis]="yearComparisonChartOptions.xaxis" [yaxis]="yearComparisonChartOptions.yaxis"
                [dataLabels]="yearComparisonChartOptions.dataLabels" [title]="yearComparisonChartOptions.title">
              </apx-chart>
            </div>
          </div>
        </div>

        <!-- Mensaje cuando no hay datos para comparar a√±os -->
        <div class="no-comparison card" *ngIf="!yearComparisonStats.year1">
          <div class="no-data-message">
            <span class="icon">‚ÑπÔ∏è</span>
            <h4>Selecciona un pa√≠s y dos a√±os para comparar</h4>
            <p>Elige un pa√≠s y dos a√±os diferentes para ver la comparaci√≥n entre a√±os</p>
          </div>
        </div>
      </section>

      <!-- Mensaje cuando no hay datos cargados -->
      <section class="no-data-section" *ngIf="!excelData.length">
        <div class="no-data-card card">
          <div class="no-data-content">
            <span class="no-data-icon">üìä</span>
            <h3>Esperando datos</h3>
            <p>Carga un archivo Excel con los datos de cr√©ditos por pa√≠s y a√±o para comenzar el an√°lisis.</p>
          </div>
        </div>
      </section>
    </div>
  </main>
</div>